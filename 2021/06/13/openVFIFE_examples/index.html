<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="GinkGo">
    
    <title>
        
            Examples of openVFIFE |
        
        GinkGo
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="https://gitee.com/ginkgoltd/pictures/raw/master/img/ginkgo.jpg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"ginkgoltd.githut.io","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":false,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"https://gitee.com/ginkgoltd/pictures/raw/master/img/ginkgo.jpg","favicon":"https://gitee.com/ginkgoltd/pictures/raw/master/img/ginkgo.jpg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"openVFIFE is a open source vector form intrinsic finite element method"},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":false},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                GinkGo
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/openVFIFE"
                            >
                                OPENVFIFE
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/openVFIFE">OPENVFIFE</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">Examples of openVFIFE</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/ginkgo.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">GinkGo</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-06-13 00:41:02
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/openVFIFE/">openVFIFE</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="examples">Examples</h1>
<p>openVFIFE is quite simple and intuitive. The basic procedures of a calculation is as follows:</p>
<ol type="1">
<li>create a <strong>StructSystem</strong> to manage all struct objects</li>
<li>create <strong>Particle</strong>s</li>
<li>create <strong>Material</strong>s and <strong>Section</strong>s (necessary in bar structures)</li>
<li>create <strong>Elements</strong></li>
<li>add constraints</li>
<li>add external force and solve</li>
</ol>
<p>the pseudocodes for the procesdure</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;structsystem.h&quot;</span>	<span class="comment">// using openVFIFE</span></span></span><br><span class="line"></span><br><span class="line">StructSystem system = <span class="built_in">StructSyste</span>(id);	<span class="comment">// create a StructSystem to manage all struct objects</span></span><br><span class="line"><span class="comment">// ... system setting</span></span><br><span class="line">Partice* p = <span class="keyword">new</span> <span class="built_in">Partice</span>(id, x, y, z);  <span class="comment">// create particle object</span></span><br><span class="line">system.<span class="built_in">addPartice</span>(p);				   <span class="comment">// add particle into system</span></span><br><span class="line">BaseMaterial mat = <span class="built_in">LinearElastic</span>(id);   <span class="comment">// create Material</span></span><br><span class="line"><span class="comment">// ... material setting</span></span><br><span class="line">BaseSection sect = <span class="built_in">Rectangle</span>(id, width, height);    <span class="comment">// create section</span></span><br><span class="line">BaseElement* e = <span class="keyword">new</span> <span class="built_in">Beam3D</span>(id, p1, p2, mat, sect);	<span class="comment">// create element</span></span><br><span class="line">system.<span class="built_in">addElement</span>(e);							  <span class="comment">// add element into system</span></span><br><span class="line">system.<span class="built_in">addConstraint</span>(pid, c);					  <span class="comment">// add constraints</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// time history solve</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nstep; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// solve first time step</span></span><br><span class="line">		system.<span class="built_in">addExternalForce</span>(pid, force);		<span class="comment">// add external force</span></span><br><span class="line">		system.<span class="built_in">solve</span>(dt, zeta, <span class="literal">true</span>);</span><br><span class="line">		system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">		system.<span class="built_in">solve</span>(h, zeta);</span><br><span class="line">		system.<span class="built_in">clearParticleForce</span>();</span><br><span class="line">		system.<span class="built_in">setExternalForce</span>(pid, f);</span><br><span class="line">		system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save results</span></span><br><span class="line">    system.<span class="built_in">saveParticleResult</span>(path);</span><br><span class="line">	system.<span class="built_in">saveElementResult</span>(path);</span><br><span class="line">	system.<span class="built_in">saveSupportReact</span>(path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">system.<span class="built_in">releaseContainers</span>();					    <span class="comment">// relase system containers</span></span><br></pre></td></tr></table></figure>
<p>As you can see in the above codes, using openVFIFE to conduct structure analysis is same as other FEM software. To illustrate the using of openVFIFE, several examples are list here. You can learn openVFIFE through these simple examples.</p>
<p>Now, let's ROCK!</p>
<h2 id="example-1">Example 1</h2>
<p>In the first example, I want to show you the moving trajectory calculation of a single paritcle, which is in horizontal projectile motion. The mass of the particle is <span class="math inline">\(10kg\)</span>, the initial speed is <span class="math inline">\(v_0 = 10m/s\)</span>, and the acceleration of gravity <span class="math inline">\(g = 9.8 m/s\)</span>. The governing equation of particle is <span class="math display">\[
Horizontal: m\ddot{x} + c\dot{x} = 0\\
Vertical: m\ddot{y} + c\dot{y} = mg\\
\]</span> where, <span class="math inline">\(c = m \zeta\)</span>, <span class="math inline">\(\zeta\)</span> is the damping parameters in openVFIFE. The solution is</p>
<p>if <span class="math inline">\(c \neq 0\)</span>: $$ x =  [1 - e^{-t}]\ v_x =  = v_0 e^{t}\ a_x =  = -v_0 e^{-t}\</p>
<p>y = t + [e^{-t}-1]\ v_y =  = [1 - e^{-t}]\ a_y =  = g e^{-t} <span class="math display">\[
else if $c=0$:
\]</span> x = v_0 t\ v_x =  = v_0\ a_x =  = 0\</p>
<p>y =  g t^2\ v_y =  = gt\ a_y =  = g $$</p>
<p>In openVFIFE, you can solve the problem by the following code(see <code>./examples/example1/example1.cpp</code>)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../../headers/structsystem.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// create system</span></span><br><span class="line">    StructSystem system = <span class="built_in">StructSystem</span>(<span class="number">1</span>);</span><br><span class="line">    system.<span class="built_in">setJobname</span>(<span class="string">&quot;Example1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> zeta = <span class="number">0.0</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Please enter a damping coefficient(&gt;=0): &quot;</span> &lt;&lt; endl;</span><br><span class="line">    cin &gt;&gt; zeta;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// solve parameters</span></span><br><span class="line">    <span class="keyword">double</span> endTime = <span class="number">10.0</span>;  <span class="comment">// total time, s</span></span><br><span class="line">    <span class="keyword">double</span> h = <span class="number">1.0e-3</span>;      <span class="comment">// time step, s</span></span><br><span class="line">    <span class="keyword">double</span> v0 = <span class="number">10</span>;         <span class="comment">// initial velocity, m/s</span></span><br><span class="line">    <span class="keyword">double</span> mass = <span class="number">10</span>;       <span class="comment">// mass, kg</span></span><br><span class="line">    <span class="keyword">double</span> g = <span class="number">9.8</span>;         <span class="comment">// acceleration of gravity, m/s-2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// create particles</span></span><br><span class="line">    Particle* p1 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p1);</span><br><span class="line">    <span class="comment">// set mass properties</span></span><br><span class="line">    StdArray6d m = &#123;mass, mass, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    p1-&gt;<span class="built_in">setLumpedMass</span>(m);</span><br><span class="line">    <span class="comment">// activate dof of particle</span></span><br><span class="line">    p1-&gt;<span class="built_in">activateDof</span>(<span class="string">&quot;Ux&quot;</span>);</span><br><span class="line">    p1-&gt;<span class="built_in">activateDof</span>(<span class="string">&quot;Uy&quot;</span>);</span><br><span class="line"></span><br><span class="line">    string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/model&quot;</span>;</span><br><span class="line">    system.<span class="built_in">saveModel</span>(path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> nStep = <span class="built_in">ceil</span>(endTime / h);</span><br><span class="line">    <span class="keyword">int</span> interval = <span class="built_in">ceil</span>(<span class="number">0.1</span>/h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= nStep; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// set initial velocity and acclerate</span></span><br><span class="line">            StdArray6d v = &#123;v0, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            p1-&gt;<span class="built_in">setVelocity</span>(v);</span><br><span class="line">            system.<span class="built_in">setAccelerate</span>(<span class="number">0</span>, <span class="number">9.8</span>, <span class="number">0</span>);</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta);</span><br><span class="line">            system.<span class="built_in">clearParticleForce</span>();</span><br><span class="line">            system.<span class="built_in">setAccelerate</span>(<span class="number">0</span>, g, <span class="number">0</span>); <span class="comment">// add external force</span></span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// save results</span></span><br><span class="line">        <span class="keyword">if</span> (i % interval == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                          <span class="built_in">to_string</span>(i*h);</span><br><span class="line">            system.<span class="built_in">saveParticleResult</span>(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    system.<span class="built_in">releaseContainers</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>and compile this code by</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">g++ -static -O3 xx.cpp -L /directory/of/libvfife.a -lvfife -o xx.out</span></span><br><span class="line">g++ -static -O3 projectile.cpp -L ../../library/static -lvfife -o projectile.out</span><br></pre></td></tr></table></figure>
<p>and run it</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">time ./xx.out</span></span><br><span class="line">time ./projectile.out</span><br><span class="line"><span class="meta">#</span><span class="bash"> you will see the following information <span class="keyword">in</span> terminal</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########## StructSystem Established! ##########</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">Please enter a damping coefficient(&gt;0):</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">10000</span></span><br><span class="line"><span class="meta">#</span><span class="bash">100</span></span><br><span class="line"><span class="meta">#</span><span class="bash">./projectile.out  0.00s user 0.01s system 0% cpu 1.392 total</span></span><br></pre></td></tr></table></figure>
<p>Finally the results of openVFIFE and theroy solution have been compared in the next figures.</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/dx.svg" /><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/dy.svg" /></p>
<p>​ (a) (b)</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/vx.svg" /><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/vy.svg" /></p>
<p>​ (c) (d)</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/ax.svg" /> <img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/ay.svg" /></p>
<p>​ (e) (f)</p>
<p>Fig. 1. Results, (a) <span class="math inline">\(x\)</span>, (b) <span class="math inline">\(y\)</span>, (c) <span class="math inline">\(\dot{x}\)</span>, (d) , (e) <span class="math inline">\(\ddot{x}\)</span> (f) <span class="math inline">\(\ddot{y}\)</span></p>
<p>when <span class="math inline">\(\zeta = \frac{c}{m}\)</span> changes from 0.0 to 1.0, openVFIFE always get the right answer. All these examples are trying to tell you how to use openVFIFE, and illustrate as a verification as well. So there will be no detailed commnets on these examples. If you are interested in these examples, just email me.</p>
<h2 id="example-2">Example 2</h2>
<p>Consider a single bar structure(as shown in the following figure) , the length <span class="math inline">\(l = 10m\)</span>, the section area is <span class="math inline">\(1m^2\)</span>, Young's modulus <span class="math inline">\(E=10^6Pa\)</span> , mass density <span class="math inline">\(\rho = 10 kg/m^3\)</span>. In this case, I want to show you how to use openVFIFE to solve static problems, and explain the influence of damping coefficient and time step.</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/example2.jpg" /></p>
<p>Fig.2. You Can Read It</p>
<p>source code, see <code>./examples/example2/example2.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../../headers/structsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// create system</span></span><br><span class="line">    StructSystem system = <span class="built_in">StructSystem</span>(<span class="number">1</span>);</span><br><span class="line">    system.<span class="built_in">setJobname</span>(<span class="string">&quot;example2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setting damping coefficient</span></span><br><span class="line">    <span class="keyword">double</span> zeta = <span class="number">0.5</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Please enter a damping coefficient(&gt;=0): &quot;</span> &lt;&lt; endl;</span><br><span class="line">    cin &gt;&gt; zeta;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setting time step</span></span><br><span class="line">    <span class="keyword">double</span> h = <span class="number">0.0</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Please enter a time step(&gt;=0): &quot;</span> &lt;&lt; endl;</span><br><span class="line">    cin &gt;&gt; h;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// solve parameters</span></span><br><span class="line">    <span class="keyword">double</span> endTime = <span class="number">50.0</span>;</span><br><span class="line">    <span class="keyword">double</span> p = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create particles</span></span><br><span class="line">    Particle * p1 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    Particle * p2 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">2</span>, <span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p1);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create material</span></span><br><span class="line">    LinearElastic mat = <span class="built_in">LinearElastic</span>(<span class="number">1</span>);</span><br><span class="line">    mat.<span class="built_in">setE</span>(<span class="number">1.0E6</span>);</span><br><span class="line">    mat.<span class="built_in">setDensity</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create section</span></span><br><span class="line">    CustomSectionParas paras = &#123;.A=<span class="number">1</span>, .Sy=<span class="number">0</span>, .Sz=<span class="number">0</span>, .SHy=<span class="number">0</span>, .SHz=<span class="number">0</span>,</span><br><span class="line">                                .CGy=<span class="number">0</span>, .CGz=<span class="number">0.0</span>, .Iyy=<span class="number">10</span>, .Izz=<span class="number">10</span>, .Iyz=<span class="number">10</span>&#125;;</span><br><span class="line">    CustomSection sect = <span class="built_in">CustomSection</span>(<span class="number">1</span>, paras);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create elements</span></span><br><span class="line">    Link2D* e = <span class="keyword">new</span> <span class="built_in">Link2D</span>(<span class="number">1</span>, p1, p2, &amp;mat, &amp;sect);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constraints, Ux, Uy, Uz, Rotx, Roty, Rotz</span></span><br><span class="line">    DOF c1 = &#123;.key = &#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">              .val = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    DOF c2 = &#123;.key = &#123;<span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">              .val = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">1</span>, c1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">2</span>, c2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save model</span></span><br><span class="line">    string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/model&quot;</span>;</span><br><span class="line">    system.<span class="built_in">saveModel</span>(path);</span><br><span class="line">    system.<span class="built_in">info</span>();      <span class="comment">// print structsystem information</span></span><br><span class="line"></span><br><span class="line">    StdArray6d f1 = &#123;<span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;	<span class="comment">//(x, y, z, mx, my, mz)</span></span><br><span class="line">    <span class="keyword">int</span> nStep = <span class="built_in">ceil</span>(endTime/h);</span><br><span class="line">    cout &lt;&lt; nStep &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">int</span> interval = <span class="built_in">ceil</span>(<span class="number">0.1</span>/h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= nStep; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">2</span>, f1);            <span class="comment">// add external force</span></span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta, <span class="literal">true</span>);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta);</span><br><span class="line">            system.<span class="built_in">clearParticleForce</span>();</span><br><span class="line">            system.<span class="built_in">setExternalForce</span>(<span class="number">2</span>, f1);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// save results</span></span><br><span class="line">        <span class="keyword">if</span> (i % interval == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                          <span class="built_in">to_string</span>(i*h);</span><br><span class="line">            system.<span class="built_in">saveParticleResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveElementResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveSupportReact</span>(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    system.<span class="built_in">releaseContainers</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>when <span class="math inline">\(\Delta t = 0.01\)</span>, the axail force of the bar</p>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(\zeta\)</span></th>
<th>Target (N)</th>
<th>openVFIFE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.0</td>
<td>100.0</td>
<td>--</td>
</tr>
<tr class="even">
<td>0.5</td>
<td>100.0</td>
<td>100.0</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>100.0</td>
<td>100.0</td>
</tr>
</tbody>
</table>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/damping.svg" /></p>
<p>Fig.3. Axial Force of The Bar</p>
<p>if <span class="math inline">\(\zeta= 0.0\)</span>, the axial force of the bar will not converge (umdamped free vibration); and when <span class="math inline">\(\zeta\)</span> increased, the answer will finally converge to the static solution, and the larger <span class="math inline">\(\zeta\)</span> is, the faster convergence is. Besides, <span class="math inline">\(\zeta\)</span> won't affect the static solution. Hence, for static problems, large <span class="math inline">\(\zeta\)</span> could be adopted to help converge.</p>
<p><strong>The critical time step</strong> <span class="math display">\[
\Delta t_{critical} = \frac{2l}{v_c} = \frac{2l}{\sqrt{E/\rho}}=0.0316s
\]</span> when <span class="math inline">\(\zeta= 0.5\)</span>, the axail force of the bar</p>
<table>
<thead>
<tr class="header">
<th><span class="math inline">\(\Delta t\)</span></th>
<th>Target (N)</th>
<th>openVFIFE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.001</td>
<td>100.0</td>
<td>99.89860658682635</td>
</tr>
<tr class="even">
<td>0.01</td>
<td>100.0</td>
<td>99.89854111776447</td>
</tr>
<tr class="odd">
<td>0.1</td>
<td>100.0</td>
<td>nan</td>
</tr>
<tr class="even">
<td>0.5</td>
<td>100.0</td>
<td>nan</td>
</tr>
</tbody>
</table>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/timestep.svg" /></p>
<ol type="a">
<li></li>
</ol>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/timestep1.svg" /></p>
<ol start="2" type="a">
<li></li>
</ol>
<p>Fig.4. Axial Force of The Bar, (a) <span class="math inline">\(\Delta t = 0.001, 0.01\)</span>, (b) <span class="math inline">\(\Delta t = 0.001, 0.01, 0.1, 0.5\)</span>,</p>
<p><strong>If <span class="math inline">\(\Delta t &gt; \Delta t_{critical}\)</span>, the solution will unconverge,</strong> hence it is important to assign time step. openVFIFE provides a <code>autoTimeStep()</code> function for setting proper time step automaticly.</p>
<h2 id="example-3">Example 3</h2>
<p>Ref: Ting, E.C., Y. F. Duan, T.Y. Wu. <em>Vector Mechanics of Structure</em>. BeiJing: Science Press, 2012. Chapter 5, example 1</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/example3.png" /></p>
<p>Fig.5. copy from the reference textbook</p>
<p>Parameters <span class="math display">\[
a = 10 m, b = 5 m;\\
P_{\alpha} = 20 N, P_{\beta} = 20N;\\
E_{\alpha} = 20000 Pa, E_{\beta} = 10000 Pa.
\]</span> Codes: (see <code>./examples/example3/example3.cpp</code>)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../../headers/structsystem.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// create system</span></span><br><span class="line">    StructSystem system = <span class="built_in">StructSystem</span>(<span class="number">1</span>);</span><br><span class="line">    system.<span class="built_in">setJobname</span>(<span class="string">&quot;example3&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// solve parameters</span></span><br><span class="line">    <span class="keyword">double</span> endTime = <span class="number">50.0</span>;</span><br><span class="line">    <span class="keyword">double</span> zeta = <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">double</span> h = <span class="number">0.01</span>;</span><br><span class="line">    <span class="keyword">double</span> p = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create particles</span></span><br><span class="line">    Particle* p1 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    Particle* p2 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">2</span>, <span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">    Particle* p3 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p1);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p2);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p3);</span><br><span class="line">    StdArray6d mass = &#123;<span class="number">10.0</span>, <span class="number">10.0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    p2-&gt;<span class="built_in">setLumpedMass</span>(mass);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create material</span></span><br><span class="line">    LinearElastic mat1 = <span class="built_in">LinearElastic</span>(<span class="number">1</span>);</span><br><span class="line">    mat1.<span class="built_in">setE</span>(<span class="number">2.0E4</span>);</span><br><span class="line">    LinearElastic mat2 = <span class="built_in">LinearElastic</span>(<span class="number">2</span>);</span><br><span class="line">    mat2.<span class="built_in">setE</span>(<span class="number">1.0E4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create section</span></span><br><span class="line">    CustomSectionParas paras = &#123;.A=<span class="number">1</span>, .Sy=<span class="number">0</span>, .Sz=<span class="number">0</span>, .SHy=<span class="number">0</span>, .SHz=<span class="number">0</span>,</span><br><span class="line">                                .CGy=<span class="number">0</span>, .CGz=<span class="number">0.0</span>, .Iyy=<span class="number">10</span>, .Izz=<span class="number">10</span>, .Iyz=<span class="number">10</span>&#125;;</span><br><span class="line">    CustomSection sect = <span class="built_in">CustomSection</span>(<span class="number">1</span>, paras);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create elements</span></span><br><span class="line">    Link2D* e1 = <span class="keyword">new</span> <span class="built_in">Link2D</span>(<span class="number">1</span>, p1, p2, &amp;mat1, &amp;sect);</span><br><span class="line">    Link2D* e2 = <span class="keyword">new</span> <span class="built_in">Link2D</span>(<span class="number">2</span>, p2, p3, &amp;mat2, &amp;sect);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e1);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constraints</span></span><br><span class="line">    DOF c1 = &#123;.key = &#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">              .val = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    DOF c3 = &#123;.key = &#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">              .val = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">1</span>, c1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">3</span>, c3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save model</span></span><br><span class="line">    string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/model&quot;</span>;</span><br><span class="line">    system.<span class="built_in">saveModel</span>(path);</span><br><span class="line">    system.<span class="built_in">info</span>();      <span class="comment">// print structsystem information</span></span><br><span class="line"></span><br><span class="line">    StdArray6d f1 = &#123;<span class="number">-20</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    StdArray6d f2 = &#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    StdArray6d f3 = &#123;<span class="number">20</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> nStep = <span class="built_in">ceil</span>(endTime/h);</span><br><span class="line">    cout &lt;&lt; nStep &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">int</span> interval = <span class="built_in">ceil</span>(<span class="number">0.1</span>/h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= nStep; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// add external force</span></span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">1</span>, f1);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">2</span>, f2);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">3</span>, f3);</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta, <span class="literal">true</span>);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta);</span><br><span class="line">            system.<span class="built_in">clearParticleForce</span>();</span><br><span class="line">            <span class="comment">// add external force</span></span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">1</span>, f1);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">2</span>, f2);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">3</span>, f3);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// save results</span></span><br><span class="line">        <span class="keyword">if</span> (i % interval == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                          <span class="built_in">to_string</span>(i*h);</span><br><span class="line">            system.<span class="built_in">saveParticleResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveElementResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveSupportReact</span>(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    system.<span class="built_in">releaseContainers</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Answer comparison</p>
<table>
<thead>
<tr class="header">
<th>Descriptions</th>
<th>Items</th>
<th>Target</th>
<th>openVFIFE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>support reactions</td>
<td><span class="math inline">\(f_{1x} (N)\)</span></td>
<td>-20</td>
<td>-20</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(f_{1y} (N)\)</span></td>
<td>20</td>
<td>20</td>
</tr>
<tr class="odd">
<td></td>
<td><span class="math inline">\(f_{3x} (N)\)</span></td>
<td>-20</td>
<td>-20</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(f_{3y} (N)\)</span></td>
<td>20</td>
<td>20</td>
</tr>
<tr class="odd">
<td>displacement of particle 2</td>
<td><span class="math inline">\(U_x (m)\)</span></td>
<td>0.01</td>
<td>0.00999503</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(U_y (m)\)</span></td>
<td>-0.01</td>
<td>-0.00999004</td>
</tr>
<tr class="odd">
<td>element axial force</td>
<td><span class="math inline">\(F_{Na} (N)\)</span></td>
<td>20</td>
<td>20</td>
</tr>
<tr class="even">
<td></td>
<td><span class="math inline">\(F_{Nb} (N)\)</span></td>
<td>20</td>
<td>20</td>
</tr>
</tbody>
</table>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/displace.svg" /></p>
<p>Fig.6. time history of displacement of particle 2</p>
<p>You can compare the results with the refence. I don't want to do it.</p>
<h2 id="example-4">Example 4</h2>
<p>Ref: Ting, E.C., Y. F. Duan, T.Y. Wu. <em>Vector Mechanics of Structure</em>. BeiJing: Science Press, 2012. Chapter 6, example 2</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/vfife.png" /><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/model.png" /></p>
<p>Fig.7. coordinate system and discrete scheme</p>
<p><strong>Parameters:</strong> <span class="math display">\[
b = 10m,\\
m_2 = 6.25 kg, m_4 = m_5 = m_6 = 2.5 kg,\\
E_{1} = 1e5Pa, E_2 = 1e4Pa,\\
P_2 = 1.0N, P_v = 0.1N.
\]</span> <span class="math inline">\(P_2\)</span> is always perpendicular to bar 1, and <span class="math inline">\(P_v\)</span> is always keep vertical.</p>
<p>codes, (see <code>./examples/example4/example4.cpp</code>)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../../headers/structsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// create system</span></span><br><span class="line">    StructSystem system = <span class="built_in">StructSystem</span>(<span class="number">1</span>);</span><br><span class="line">    system.<span class="built_in">setJobname</span>(<span class="string">&quot;example4&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// solve parameters</span></span><br><span class="line">    <span class="keyword">double</span> endTime = <span class="number">50.0</span>;  <span class="comment">// total time, s</span></span><br><span class="line">    <span class="keyword">double</span> zeta = <span class="number">0.5</span>;      <span class="comment">// damping coefficient</span></span><br><span class="line">    <span class="keyword">double</span> h = <span class="number">0.01</span>;        <span class="comment">// time step, s</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// create particles</span></span><br><span class="line">    Particle* p1 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">1</span>, <span class="number">0.0</span>, <span class="number">10.0</span>);</span><br><span class="line">    Particle* p2 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">2</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    Particle* p3 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">3</span>, <span class="number">10.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    Particle* p4 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">4</span>, <span class="number">2.5</span>, <span class="number">0.0</span>);</span><br><span class="line">    Particle* p5 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">5</span>, <span class="number">5.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    Particle* p6 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">6</span>, <span class="number">7.5</span>, <span class="number">0.0</span>);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p1);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p2);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p3);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p4);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p5);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p6);</span><br><span class="line"></span><br><span class="line">    StdArray6d mass2 = &#123;<span class="number">6.25</span>, <span class="number">6.25</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    p2-&gt;<span class="built_in">setLumpedMass</span>(mass2);</span><br><span class="line">    StdArray6d mass4 = &#123;<span class="number">2.5</span>, <span class="number">2.5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    p4-&gt;<span class="built_in">setLumpedMass</span>(mass4);</span><br><span class="line">    p5-&gt;<span class="built_in">setLumpedMass</span>(mass4);</span><br><span class="line">    p6-&gt;<span class="built_in">setLumpedMass</span>(mass4);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create material</span></span><br><span class="line">    LinearElastic mat1 = <span class="built_in">LinearElastic</span>(<span class="number">1</span>);</span><br><span class="line">    mat1.<span class="built_in">setE</span>(<span class="number">1.0E5</span>);</span><br><span class="line">    LinearElastic mat2 = <span class="built_in">LinearElastic</span>(<span class="number">2</span>);</span><br><span class="line">    mat2.<span class="built_in">setE</span>(<span class="number">1.0E4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create section</span></span><br><span class="line">    CustomSectionParas paras = &#123;.A=<span class="number">1</span>, .Sy=<span class="number">0</span>, .Sz=<span class="number">0</span>, .SHy=<span class="number">0</span>, .SHz=<span class="number">0</span>,</span><br><span class="line">                                .CGy=<span class="number">0</span>, .CGz=<span class="number">0.0</span>, .Iyy=<span class="number">10</span>, .Izz=<span class="number">10</span>, .Iyz=<span class="number">10</span>&#125;;</span><br><span class="line">    CustomSection sect = <span class="built_in">CustomSection</span>(<span class="number">1</span>, paras);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create elements, flexible link</span></span><br><span class="line">    Link2DLD* e1 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">1</span>, p1, p2, &amp;mat1, &amp;sect);</span><br><span class="line">    Link2DLD* e2 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">2</span>, p2, p4, &amp;mat2, &amp;sect);</span><br><span class="line">    Link2DLD* e3 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">3</span>, p4, p5, &amp;mat2, &amp;sect);</span><br><span class="line">    Link2DLD* e4 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">4</span>, p5, p6, &amp;mat2, &amp;sect);</span><br><span class="line">    Link2DLD* e5 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">5</span>, p6, p3, &amp;mat2, &amp;sect);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e1);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e2);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e3);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e4);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e5);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constraints</span></span><br><span class="line">    DOF c1 = &#123;.key = &#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">              .val = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    DOF c3 = &#123;.key = &#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">              .val = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">1</span>, c1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">3</span>, c3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save model</span></span><br><span class="line">    string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/model&quot;</span>;</span><br><span class="line">    system.<span class="built_in">saveModel</span>(path);</span><br><span class="line">    system.<span class="built_in">info</span>();      <span class="comment">// print structsystem information</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// get the direction vector of bar1</span></span><br><span class="line">    <span class="keyword">const</span> Eigen::Vector3d* ex = e1-&gt;<span class="built_in">ex</span>();</span><br><span class="line">    StdArray6d P2 = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    StdArray6d Pv = &#123;<span class="number">0</span>, <span class="number">-0.1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> nStep = <span class="built_in">ceil</span>(endTime/h);</span><br><span class="line">    cout &lt;&lt; nStep &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">int</span> interval = <span class="built_in">ceil</span>(<span class="number">0.1</span>/h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= nStep; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// update P2</span></span><br><span class="line">        P2[<span class="number">0</span>] = <span class="number">10</span> * (*ex)(<span class="number">0</span>);</span><br><span class="line">        P2[<span class="number">1</span>] = <span class="number">-10</span> * (*ex)(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// add external force</span></span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">2</span>, P2);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">4</span>, Pv);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">5</span>, Pv);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">6</span>, Pv);</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta, <span class="literal">true</span>);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta);</span><br><span class="line">            system.<span class="built_in">clearParticleForce</span>();</span><br><span class="line">            <span class="comment">// add external force</span></span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">2</span>, P2);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">4</span>, Pv);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">5</span>, Pv);</span><br><span class="line">            system.<span class="built_in">addExternalForce</span>(<span class="number">6</span>, Pv);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// save results</span></span><br><span class="line">        <span class="keyword">if</span> (i % interval == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                          <span class="built_in">to_string</span>(i);</span><br><span class="line">            system.<span class="built_in">saveModel</span>(path);</span><br><span class="line">            system.<span class="built_in">saveParticleResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveElementResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveSupportReact</span>(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    system.<span class="built_in">releaseContainers</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/example4.gif" /></p>
<p>Fig.8. movement of the structure</p>
<h2 id="example-5">Example 5</h2>
<p>In example 1, a planar three-bar truss subjected to a load <span class="math inline">\(P\)</span> in the <span class="math inline">\(y\)</span> is analyzed, as shown in Fig.9. The cross-sectional area (<span class="math inline">\(A\)</span>) of bars is <span class="math inline">\(1m^2\)</span>; the length (<span class="math inline">\(L_{BD}\)</span> is <span class="math inline">\(1m\)</span>; <span class="math inline">\(\ang ADB = \ang CDB = 45^ \circ\)</span>. different plastic material models are considered: an ideal elastic-plastic model and an elastic linear hardening model, as shown in Fig.11. The density (<span class="math inline">\(\rho\)</span>) of the bars is <span class="math inline">\(7850kg\)</span>. Young's modulus <span class="math inline">\(E\)</span> is <span class="math inline">\(206GPa\)</span> in the elastic state; the tangent modulus $Et $ is <span class="math inline">\(20.6GPa\)</span> in the plastic state; and the yield stress (<span class="math inline">\(\sigma _y\)</span>) is <span class="math inline">\(235MPa\)</span>.</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/example5.png" /></p>
<p>Fig.9. example 5</p>
<p>codes, (see <code>./examples/example5/example5.cpp</code>)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../../headers/structsystem.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// command-line parameters</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Please enter P: &quot;</span>;</span><br><span class="line">    <span class="keyword">double</span> load_factor;</span><br><span class="line">    cin &gt;&gt; load_factor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create system</span></span><br><span class="line">    StructSystem system = <span class="built_in">StructSystem</span>(<span class="number">1</span>);</span><br><span class="line">    system.<span class="built_in">setJobname</span>(<span class="string">&quot;BilinearTruss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// solve parameters</span></span><br><span class="line">    <span class="keyword">double</span> endTime = <span class="number">100.0</span>;</span><br><span class="line">    <span class="keyword">double</span> h = <span class="number">1.0e-3</span>;</span><br><span class="line">    <span class="keyword">double</span> zeta = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">double</span> length = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">double</span> theta = <span class="number">45.0</span> / <span class="number">180</span> * PI;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create particles</span></span><br><span class="line">    Particle* p1 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">1</span>, -length, <span class="number">0</span>);</span><br><span class="line">    Particle* p2 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    Particle* p3 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">3</span>, length, <span class="number">0</span>);</span><br><span class="line">    Particle* p4 = <span class="keyword">new</span> <span class="built_in">Particle</span>(<span class="number">4</span>, <span class="number">0</span>, length);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p1);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p2);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p3);</span><br><span class="line">    system.<span class="built_in">addParticle</span>(p4);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create material</span></span><br><span class="line">    <span class="keyword">double</span> E = <span class="number">2.06e11</span>;</span><br><span class="line">    <span class="keyword">double</span> yield_stress = <span class="number">2.35e8</span>;</span><br><span class="line">    <span class="keyword">double</span> Et = <span class="number">2.06e10</span>;</span><br><span class="line">    <span class="keyword">double</span> m = <span class="number">0</span>;</span><br><span class="line">    UniBilinear mat = <span class="built_in">UniBilinear</span>(<span class="number">1</span>, E, Et, yield_stress, m);</span><br><span class="line">    mat.<span class="built_in">setDensity</span>(<span class="number">7850</span>);</span><br><span class="line">    <span class="comment">// LinearElastic mat = LinearElastic(1);</span></span><br><span class="line">    <span class="comment">// mat.setE(E);</span></span><br><span class="line">    <span class="comment">// mat.setDensity(7850);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// create section</span></span><br><span class="line">    CustomSectionParas paras = &#123;.A=<span class="number">1.0</span>, .Sy=<span class="number">0</span>, .Sz=<span class="number">0</span>, .SHy=<span class="number">0</span>, .SHz=<span class="number">0</span>, .CGy=<span class="number">0</span>,</span><br><span class="line">                                .CGz=<span class="number">0.0</span>, .Iyy=<span class="number">0.01</span>, .Izz=<span class="number">0.01</span>, .Iyz=<span class="number">0</span>&#125;;</span><br><span class="line">    CustomSection sect = <span class="built_in">CustomSection</span>(<span class="number">1</span>, paras);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create elements</span></span><br><span class="line">    Link2DLD* e1 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">1</span>, p1, p4, &amp;mat, &amp;sect);</span><br><span class="line">    Link2DLD* e2 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">2</span>, p2, p4, &amp;mat, &amp;sect);</span><br><span class="line">    Link2DLD* e3 = <span class="keyword">new</span> <span class="built_in">Link2DLD</span>(<span class="number">3</span>, p3, p4, &amp;mat, &amp;sect);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e1);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e2);</span><br><span class="line">    system.<span class="built_in">addElement</span>(e3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constraints</span></span><br><span class="line">    DOF c = &#123;.key = &#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>&#125;,</span><br><span class="line">              .val = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        system.<span class="built_in">addConstraint</span>(i, c);</span><br><span class="line">    &#125;</span><br><span class="line">    system.<span class="built_in">info</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save model information</span></span><br><span class="line">    string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/model&quot;</span>;</span><br><span class="line">    system.<span class="built_in">saveModel</span>(path);</span><br><span class="line"></span><br><span class="line">    StdArray6d f &#123;&#125;;</span><br><span class="line">    <span class="comment">// f[1] = load_factor;</span></span><br><span class="line">    system.<span class="built_in">addExternalForce</span>(<span class="number">4</span>, f);</span><br><span class="line">    system.<span class="built_in">solve</span>(h, zeta, <span class="literal">true</span>);</span><br><span class="line">    system.<span class="built_in">setInternalForce</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> nStep = <span class="built_in">ceil</span>(endTime / h);</span><br><span class="line">    <span class="keyword">int</span> interval = <span class="built_in">ceil</span>(<span class="number">1</span> / h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= nStep; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        system.<span class="built_in">solve</span>(h, zeta, <span class="literal">false</span>);</span><br><span class="line">        system.<span class="built_in">clearParticleForce</span>();</span><br><span class="line">        f[<span class="number">1</span>] =  load_factor * (j * <span class="number">1.0</span> / nStep);</span><br><span class="line">        system.<span class="built_in">setExternalForce</span>(<span class="number">4</span>, f);</span><br><span class="line">        system.<span class="built_in">setInternalForce</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// save results</span></span><br><span class="line">        <span class="keyword">if</span> (j % interval == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                          <span class="built_in">to_string</span>(f[<span class="number">1</span>]);</span><br><span class="line">            system.<span class="built_in">saveParticleResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveElementResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveSupportReact</span>(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    system.<span class="built_in">releaseContainers</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/fig12a.svg" /></p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/fig12b.svg" /></p>
<p>Fig.10. results comparison</p>
<h2 id="example-6">Example 6</h2>
<p>To illustrate the capability of VFIFE in geometric nonlinear analysis, and to test the Link3DLD element, a 24-member shallow dome (as shown in Fig.13) is analyzed by openVFIFE. The topological relationship between elements and particles is depicted in Fig.11, as well as geometry information. The density <span class="math inline">\(\rho\)</span> of the bars is <span class="math inline">\(20lb/in^3\)</span>; Young’s modulus <span class="math inline">\(E\)</span> is <span class="math inline">\(10^6ksi\)</span>; and the cross-sectional area (A) of the bars is <span class="math inline">\(0.1in^2\)</span>. A concentrated force <span class="math inline">\(P\)</span> is imposed on node 1 in the <span class="math inline">\(z\)</span> direction.</p>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/%E5%9B%BE%E7%89%871.png" /></p>
<p>Fig.11. structures</p>
<p>codes, (see <code>./examples/example6/example6.cpp</code>)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;../../headers/structsystem.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">double</span> x, y, z;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Element</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">int</span> mat;</span><br><span class="line">    <span class="keyword">int</span> typ;</span><br><span class="line">    <span class="keyword">int</span> sec;</span><br><span class="line">    <span class="keyword">int</span> p1, p2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">importNodes</span><span class="params">(<span class="keyword">const</span> string &amp;fname, vector&lt;Point&gt; &amp;v1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ifstream fin;</span><br><span class="line">    fin.<span class="built_in">open</span>(fname.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">if</span> (!fin.<span class="built_in">is_open</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; fname &lt;&lt; <span class="string">&quot;: open file failed&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string line;</span><br><span class="line">    <span class="built_in">getline</span>(fin, line);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> comma;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Point p;</span><br><span class="line">        fin &gt;&gt; p.id &gt;&gt; comma &gt;&gt; p.x &gt;&gt; comma &gt;&gt; p.y &gt;&gt; comma &gt;&gt; p.z;</span><br><span class="line">        <span class="keyword">if</span>(!fin.<span class="built_in">good</span>()) <span class="keyword">break</span>;</span><br><span class="line">        v1.<span class="built_in">push_back</span>(p);</span><br><span class="line">    &#125;</span><br><span class="line">    fin.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">importElements</span><span class="params">(<span class="keyword">const</span> string &amp;fname, vector&lt;Element&gt; &amp;v1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ifstream fin;</span><br><span class="line">    fin.<span class="built_in">open</span>(fname.<span class="built_in">c_str</span>());</span><br><span class="line">    <span class="keyword">if</span> (!fin.<span class="built_in">is_open</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        cerr &lt;&lt; fname &lt;&lt; <span class="string">&quot;: open file failed&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    string line;</span><br><span class="line">    <span class="built_in">getline</span>(fin, line);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> comma;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Element e;</span><br><span class="line">        fin &gt;&gt; e.id &gt;&gt; comma &gt;&gt; e.mat &gt;&gt; comma &gt;&gt; e.typ &gt;&gt; comma &gt;&gt; e.sec</span><br><span class="line">            &gt;&gt; comma &gt;&gt; e.p1 &gt;&gt; comma &gt;&gt; e.p2;</span><br><span class="line">        <span class="keyword">if</span>(!fin.<span class="built_in">good</span>()) <span class="keyword">break</span>;</span><br><span class="line">        v1.<span class="built_in">push_back</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    fin.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">saveExternalForce</span><span class="params">(<span class="keyword">const</span> std::string &amp;path, Particle* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// create file</span></span><br><span class="line">    string fname = path + <span class="string">&quot;/particle_&quot;</span> + <span class="built_in">to_string</span>(p-&gt;<span class="built_in">id</span>())+ <span class="string">&quot;.csv&quot;</span>;</span><br><span class="line">    fstream fout;</span><br><span class="line">    fout.<span class="built_in">open</span>(fname, ios::out | ios::app);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// write header</span></span><br><span class="line">    string header = <span class="string">&quot;PID, Fx, Fy, Fz, Mx, My, Mz&quot;</span>;</span><br><span class="line">    fout &lt;&lt; header &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// write data</span></span><br><span class="line">    p-&gt;<span class="built_in">outputReactionForce</span>(fout);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// close file</span></span><br><span class="line">    fout.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// create system</span></span><br><span class="line">    StructSystem system = <span class="built_in">StructSystem</span>(<span class="number">1</span>);</span><br><span class="line">    system.<span class="built_in">setJobname</span>(<span class="string">&quot;Star&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// solve parameters</span></span><br><span class="line">    <span class="keyword">double</span> endTime = <span class="number">100.0</span>;</span><br><span class="line">    <span class="keyword">double</span> zeta = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">double</span> d = <span class="number">6.0</span>;</span><br><span class="line">    <span class="keyword">double</span> rtime = <span class="number">50.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// import structure parameters</span></span><br><span class="line">    string fnode = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;nodes.csv&quot;</span>;</span><br><span class="line">    vector&lt;Point&gt; points;</span><br><span class="line">    <span class="built_in">importNodes</span>(fnode, points);</span><br><span class="line"></span><br><span class="line">    string felems = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;elements.csv&quot;</span>;</span><br><span class="line">    vector&lt;Element&gt; elements;</span><br><span class="line">    <span class="built_in">importElements</span>(felems, elements);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create particles</span></span><br><span class="line">    map&lt;<span class="keyword">int</span>, Particle*&gt; particles;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; points.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Particle* p = <span class="keyword">new</span> <span class="built_in">Particle</span>(points[i].id, points[i].x, points[i].y, points[i].z);</span><br><span class="line">        system.<span class="built_in">addParticle</span>(p);</span><br><span class="line">        particles[points[i].id] = p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create material</span></span><br><span class="line">    LinearElastic mat = <span class="built_in">LinearElastic</span>(<span class="number">1</span>);</span><br><span class="line">    mat.<span class="built_in">setE</span>(<span class="number">1.0E6</span>);</span><br><span class="line">    mat.<span class="built_in">setDensity</span>(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create section</span></span><br><span class="line">    CustomSectionParas paras = &#123;.A=<span class="number">0.1</span>, .Sy=<span class="number">0</span>, .Sz=<span class="number">0</span>, .SHy=<span class="number">0</span>, .SHz=<span class="number">0</span>,</span><br><span class="line">                          .CGy=<span class="number">0</span>, .CGz=<span class="number">0.0</span>, .Iyy=<span class="number">0.01</span>, .Izz=<span class="number">0.01</span>, .Iyz=<span class="number">10</span>&#125;;</span><br><span class="line">    CustomSection sect = <span class="built_in">CustomSection</span>(<span class="number">1</span>, paras);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create elements</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; elements.<span class="built_in">size</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> id = elements[i].id;</span><br><span class="line">        <span class="keyword">int</span> p1 = elements[i].p1;</span><br><span class="line">        <span class="keyword">int</span> p2 = elements[i].p2;</span><br><span class="line">        Link3DLD* e = <span class="keyword">new</span> <span class="built_in">Link3DLD</span>(id, particles[p1], particles[p2],</span><br><span class="line">                           &amp;mat, &amp;sect);</span><br><span class="line">        system.<span class="built_in">addElement</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constraints</span></span><br><span class="line">    DOF v1 = &#123;.key=&#123;<span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>&#125;,</span><br><span class="line">              .val=&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">8</span>, v1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">9</span>, v1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">10</span>, v1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">11</span>, v1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">12</span>, v1);</span><br><span class="line">    system.<span class="built_in">addConstraint</span>(<span class="number">13</span>, v1);</span><br><span class="line">    system.<span class="built_in">info</span>();</span><br><span class="line"></span><br><span class="line">    string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/model&quot;</span>;</span><br><span class="line">    system.<span class="built_in">saveModel</span>(path);</span><br><span class="line">    StdArray6d d1 &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// setting parameters</span></span><br><span class="line">    <span class="keyword">double</span> h = system.<span class="built_in">autoTimeStep</span>();</span><br><span class="line">    system.<span class="built_in">setDampCoeff</span>(zeta);</span><br><span class="line">    <span class="keyword">int</span> nStep = <span class="built_in">ceil</span>(endTime / h);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> interval = <span class="built_in">ceil</span>(<span class="number">0.1</span> / h);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;##### start calculating ######&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= nStep; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        d1[<span class="number">2</span>] = -d * (<span class="keyword">double</span>)i / nStep;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            system.<span class="built_in">setParticleDisplace</span>(<span class="number">1</span>, d1);</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta, <span class="literal">true</span>);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            system.<span class="built_in">solve</span>(h, zeta, <span class="literal">false</span>);</span><br><span class="line">            system.<span class="built_in">clearParticleForce</span>();</span><br><span class="line">            system.<span class="built_in">setParticleDisplace</span>(<span class="number">1</span>, d1);</span><br><span class="line">            system.<span class="built_in">setInternalForce</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// save results</span></span><br><span class="line">        <span class="keyword">if</span> (i % interval == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            string path = system.<span class="built_in">workdir</span>() + <span class="string">&quot;/&quot;</span> + system.<span class="built_in">jobname</span>() + <span class="string">&quot;/&quot;</span> +</span><br><span class="line">                          <span class="built_in">to_string</span>(i * h);</span><br><span class="line">            system.<span class="built_in">saveParticleResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveElementResult</span>(path);</span><br><span class="line">            system.<span class="built_in">saveSupportReact</span>(path);</span><br><span class="line">            <span class="built_in">saveExternalForce</span>(path, particles[<span class="number">1</span>]);</span><br><span class="line">            <span class="built_in">saveExternalForce</span>(path, particles[<span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;##### finished ######&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    system.<span class="built_in">releaseContainers</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/Fig14a.svg" width="300px"/></p>
<ol type="a">
<li></li>
</ol>
<p><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/Fig14c.svg" width="300px" /><img src="https://gitee.com/ginkgoltd/pictures/raw/master/img/Fig14b.svg" width="300px"/></p>
<ol start="2" type="a">
<li><ol start="3" type="a">
<li></li>
</ol></li>
</ol>
<p>​ Fig. 12 force-displace curve, (a) <span class="math inline">\(F-U_z\)</span> at particle 1 (b) <span class="math inline">\(F-U_x\)</span> at particle 2, (c) <span class="math inline">\(F-U_z\)</span> at particle 2</p>
<p>More examples will be added in the near future, I believe you can get the basic concepts of openVFIFE.</p>
<p>Hope you can have a good experience in using openVFIFE.</p>
<p>I will write a detailed documentation for users and developers once I graduate. And I am looking forward to your advices and suggestions.</p>
<p>Best wishes!</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：Examples of openVFIFE</li>
        <li>Post author：GinkGo</li>
        <li>Create time：2021-06-13 00:41:02</li>
        <li>
            Post link：https://ginkgoltd.github.io/2021/06/13/openVFIFE_examples/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/06/13/WAWS/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">谐波合成法的Python实现及其使用手册</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
            </div>
        

        
        
        
            
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    
          
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2021</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">GinkGo</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#examples"><span class="nav-number">1.</span> <span class="nav-text">Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#example-1"><span class="nav-number">1.1.</span> <span class="nav-text">Example 1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#example-2"><span class="nav-number">1.2.</span> <span class="nav-text">Example 2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#example-3"><span class="nav-number">1.3.</span> <span class="nav-text">Example 3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#example-4"><span class="nav-number">1.4.</span> <span class="nav-text">Example 4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#example-5"><span class="nav-number">1.5.</span> <span class="nav-text">Example 5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#example-6"><span class="nav-number">1.6.</span> <span class="nav-text">Example 6</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/code-copy.js"></script>




<div class="post-scripts">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.3/source/js/toc.js"></script>
    
</div>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
